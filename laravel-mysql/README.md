# Laravel Posts API

A production-structured REST API built with Laravel 11 and MySQL for managing blog posts (CRUD).

---

## 1. Project Overview

This project is a **Posts CRUD REST API** built with Laravel 11 and MySQL. It exposes a clean JSON API for creating, reading, updating, and deleting blog posts. The project is containerised with Docker and uses multi-stage builds to keep the production image lean.

Key features:
- Full CRUD for blog posts (title, content, author, published flag)
- Filter posts by published status
- Health check endpoint with live database ping
- Input validation with automatic 422 error responses
- 404 JSON responses for missing resources
- Docker + MySQL via Docker Compose for zero-config local development

---

## 2. Tech Stack

| Layer         | Technology                        |
|---------------|-----------------------------------|
| Language      | PHP 8.2                           |
| Framework     | Laravel 11                        |
| ORM           | Eloquent ORM (built into Laravel) |
| Database      | MySQL 8.0                         |
| Dependency Mgr| Composer 2                        |
| Containerisation | Docker + Docker Compose        |
| Server (dev)  | `php artisan serve` (built-in)    |

---

## 3. Architecture

```
          HTTP Request
               |
               v
  +---------------------------+
  |   public/index.php        |  <-- Single entry point (front controller)
  |   (Laravel bootstrapper)  |
  +---------------------------+
               |
               v
  +---------------------------+
  |   routes/api.php          |  <-- Laravel Router
  |   /api/posts, /api/health |      All routes prefixed with /api
  +---------------------------+
               |
               v
  +---------------------------+
  |   PostController          |  <-- Controller (HTTP layer)
  |   HealthController        |      Validates input, calls model, returns JSON
  +---------------------------+
               |
               v
  +---------------------------+
  |   Post (Eloquent Model)   |  <-- Model (business/data layer)
  |   app/Models/Post.php     |      Maps to 'posts' table in MySQL
  +---------------------------+
               |
               v
  +---------------------------+
  |   MySQL 8.0               |  <-- Database
  |   posts table             |      Managed by Laravel migrations
  +---------------------------+
```

**MVC Pattern in Laravel:**
- **Model** (`app/Models/Post.php`) — Represents a database row. Eloquent handles all SQL automatically. Defines which fields are fillable and how columns are cast to PHP types.
- **Controller** (`app/Http/Controllers/PostController.php`) — Receives HTTP requests, validates input, delegates to the model, returns JSON responses. Contains no HTML — this is a pure API project.
- **View** — Not used in this API project. In a full Laravel app, views would be Blade templates. Here, `response()->json()` replaces views.

**Why no View layer?** This is a headless API. The consumer (a frontend, mobile app, or another service) is responsible for rendering the data.

---

## 4. Folder Structure

```
laravel-mysql/
├── app/
│   ├── Http/
│   │   └── Controllers/         # Request handlers — one method per HTTP action
│   │       ├── PostController.php
│   │       └── HealthController.php
│   └── Models/
│       └── Post.php             # Eloquent model — maps to 'posts' DB table
│
├── bootstrap/
│   └── app.php                  # Laravel 11 bootstrap — wires routing, middleware, exceptions
│
├── config/
│   ├── app.php                  # App-level config (name, env, timezone, service providers)
│   └── database.php             # Database connection config (reads from .env)
│
├── database/
│   └── migrations/
│       └── 2024_01_01_000000_create_posts_table.php  # DB schema version control
│
├── routes/
│   └── api.php                  # All API route definitions (auto-prefixed with /api)
│
├── public/
│   └── index.php                # Web server document root — ALL requests enter here
│
├── vendor/                      # Composer dependencies (git-ignored, generated by composer install)
│
├── composer.json                # PHP dependency manifest
├── artisan                      # Laravel CLI entry point (php artisan <command>)
├── entrypoint.sh                # Docker container startup script
├── Dockerfile                   # Multi-stage Docker build definition
├── docker-compose.yml           # Orchestrates web + db services
├── .env.example                 # Environment variable template (safe to commit)
├── .env                         # Actual secrets (git-ignored — never commit this)
├── .dockerignore                # Files excluded from Docker build context
└── .gitignore                   # Files excluded from git
```

**Laravel convention notes:**
- `app/` — All application code lives here (models, controllers, middleware, etc.)
- `bootstrap/` — Framework initialisation only — do not put application logic here
- `config/` — Static configuration; runtime values come from `.env` via `env()`
- `database/migrations/` — Each file is a versioned schema change; run with `php artisan migrate`
- `routes/` — URL-to-controller mapping; `api.php` handles API routes, `web.php` handles browser routes
- `public/` — The ONLY folder the web server should expose to the internet
- `vendor/` — Auto-generated by Composer; never edit files here manually

---

## 5. Local Setup (without Docker)

**Prerequisites:**
- PHP 8.2+ with extensions: `pdo_mysql`, `mbstring`, `xml`
- Composer 2
- MySQL 8.0 running locally

**Steps:**

```bash
# 1. Clone the repository
git clone <your-repo-url>
cd laravel-mysql

# 2. Install PHP dependencies
composer install

# 3. Copy environment file and configure your local DB credentials
cp .env.example .env
# Edit .env — set DB_HOST=127.0.0.1, DB_DATABASE, DB_USERNAME, DB_PASSWORD

# 4. Generate the application encryption key
php artisan key:generate

# 5. Run database migrations (creates the 'posts' table)
php artisan migrate

# 6. Start the development server
php artisan serve
# API is now available at http://localhost:8000
```

**Verify it works:**
```bash
curl http://localhost:8000/api/health
```

---

## 6. Docker Setup (recommended)

**Prerequisites:** Docker Desktop (or Docker Engine + Compose plugin)

```bash
# 1. Copy and configure environment file
cp .env.example .env
# The defaults in .env.example work out of the box with Docker Compose

# 2. Build and start all services
docker compose up --build
```

Docker Compose starts two services:
- `db` — MySQL 8.0, waits until healthy before starting the web container
- `web` — Laravel app; runs migrations automatically on startup, then serves on port 8000

**First build note:** The initial `docker compose up --build` downloads base images and installs all Composer dependencies. This typically takes **2-3 minutes**. Subsequent starts are near-instant.

**Useful commands:**
```bash
# Run in background
docker compose up --build -d

# View logs
docker compose logs -f web

# Run artisan commands inside the container
docker compose exec web php artisan route:list

# Stop and remove containers (preserves the mysql_data volume)
docker compose down

# Stop and remove containers AND the database volume (full reset)
docker compose down -v
```

**API is available at:** `http://localhost:8000`

---

## 7. API Endpoints

Base URL: `http://localhost:8000`

| Method | Endpoint            | Description                            | Success Code |
|--------|---------------------|----------------------------------------|--------------|
| GET    | `/api/health`       | Health check — tests DB connectivity  | 200          |
| GET    | `/api/posts`        | List all posts (supports `?published=true/false` filter) | 200 |
| POST   | `/api/posts`        | Create a new post                      | 201          |
| GET    | `/api/posts/{id}`   | Get a single post by ID               | 200          |
| PUT    | `/api/posts/{id}`   | Update a post (partial updates OK)    | 200          |
| DELETE | `/api/posts/{id}`   | Delete a post                         | 200          |

**Request body fields for POST/PUT:**

| Field       | Type    | Required (POST) | Description                        |
|-------------|---------|----------------|------------------------------------|
| `title`     | string  | Yes             | Post title (max 255 chars)         |
| `content`   | string  | Yes             | Post body text                     |
| `author`    | string  | No              | Author name (max 100 chars, defaults to "Anonymous") |
| `published` | boolean | No              | `true` = published, `false` = draft (default: false) |

**Error responses:**
- `422 Unprocessable Entity` — Validation failed; body contains field-level error messages
- `404 Not Found` — Post with given ID does not exist
- `500 Internal Server Error` — Database unreachable (visible via `/api/health`)

---

## 8. curl Examples

```bash
# ── Health check ──────────────────────────────────────────────────────────
curl -s http://localhost:8000/api/health | jq

# ── Create a post ─────────────────────────────────────────────────────────
curl -s -X POST http://localhost:8000/api/posts \
  -H "Content-Type: application/json" \
  -d '{
    "title": "My First Post",
    "content": "Hello world! This is the post content.",
    "author": "Jane Doe",
    "published": false
  }' | jq

# ── Create a published post ───────────────────────────────────────────────
curl -s -X POST http://localhost:8000/api/posts \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Going Live",
    "content": "This post is immediately published.",
    "author": "John Smith",
    "published": true
  }' | jq

# ── List all posts ────────────────────────────────────────────────────────
curl -s http://localhost:8000/api/posts | jq

# ── List only published posts ─────────────────────────────────────────────
curl -s "http://localhost:8000/api/posts?published=true" | jq

# ── List only draft posts ─────────────────────────────────────────────────
curl -s "http://localhost:8000/api/posts?published=false" | jq

# ── Get a single post (replace 1 with your post ID) ──────────────────────
curl -s http://localhost:8000/api/posts/1 | jq

# ── Update a post (partial update — only send fields you want to change) ──
curl -s -X PUT http://localhost:8000/api/posts/1 \
  -H "Content-Type: application/json" \
  -d '{
    "published": true,
    "title": "My First Post (Updated)"
  }' | jq

# ── Delete a post ─────────────────────────────────────────────────────────
curl -s -X DELETE http://localhost:8000/api/posts/1 | jq

# ── Trigger a 404 error ───────────────────────────────────────────────────
curl -s http://localhost:8000/api/posts/99999 | jq

# ── Trigger a 422 validation error ───────────────────────────────────────
curl -s -X POST http://localhost:8000/api/posts \
  -H "Content-Type: application/json" \
  -d '{"author": "No Title or Content"}' | jq
```

---

## 9. Environment Variables

| Variable          | Default              | Description                                          |
|-------------------|----------------------|------------------------------------------------------|
| `APP_NAME`        | `Laravel Posts API`  | Application name (used in logs and error messages)   |
| `APP_ENV`         | `local`              | Environment: `local`, `production`, `testing`        |
| `APP_KEY`         | _(empty)_            | 32-char encryption key. Generate with `php artisan key:generate` |
| `APP_DEBUG`       | `true`               | Set to `false` in production to hide stack traces    |
| `APP_URL`         | `http://localhost:8000` | Public URL of the application                    |
| `DB_CONNECTION`   | `mysql`              | Database driver (mysql, pgsql, sqlite)               |
| `DB_HOST`         | `db`                 | Database hostname. Use `db` for Docker, `127.0.0.1` for local |
| `DB_PORT`         | `3306`               | MySQL port                                           |
| `DB_DATABASE`     | `postsdb`            | Name of the MySQL database                          |
| `DB_USERNAME`     | `postuser`           | MySQL user for the application                      |
| `DB_PASSWORD`     | `postpassword`       | MySQL password for `DB_USERNAME`                    |
| `DB_ROOT_PASSWORD`| `rootpassword`       | MySQL root password (Docker only, for MYSQL_ROOT_PASSWORD) |

**Security note:** Never commit your `.env` file. The `.gitignore` already excludes it. Only `.env.example` (with no real secrets) should be committed.

---

## 10. Key Laravel Concepts

### Eloquent ORM
Eloquent is Laravel's built-in Object-Relational Mapper. Each database table has a corresponding Model class. Eloquent translates PHP method calls into SQL automatically:
```php
Post::all();                          // SELECT * FROM posts
Post::where('published', true)->get(); // SELECT * FROM posts WHERE published = 1
Post::findOrFail(5);                  // SELECT * FROM posts WHERE id = 5 (throws 404 if missing)
Post::create(['title' => '...']);     // INSERT INTO posts ...
$post->update(['published' => true]); // UPDATE posts SET published = 1 WHERE id = ?
$post->delete();                      // DELETE FROM posts WHERE id = ?
```

### Migrations
Migrations are PHP files that describe database schema changes. They act as version control for your database, allowing the whole team to keep their schema in sync.
```bash
php artisan migrate              # Apply all pending migrations
php artisan migrate:rollback     # Undo the last batch of migrations
php artisan migrate:fresh        # Drop all tables and re-run all migrations
php artisan migrate:status       # Show which migrations have run
```

### $fillable (Mass Assignment Protection)
Laravel's Eloquent prevents malicious users from setting arbitrary fields via `Post::create($request->all())`. The `$fillable` array on the model whitelists which fields may be mass-assigned:
```php
protected $fillable = ['title', 'content', 'author', 'published'];
```
Any field not in `$fillable` is silently ignored during `create()` or `fill()`.

### Validation
Laravel's `$request->validate()` method checks input against rules and automatically returns a `422 Unprocessable Entity` JSON response with field-level error messages if validation fails — no try/catch needed:
```php
$validated = $request->validate([
    'title'   => 'required|string|max:255',
    'content' => 'required|string',
]);
// If validation fails, Laravel returns 422 automatically.
// If validation passes, $validated contains only the validated fields.
```

### apiResource Routes
`Route::apiResource('posts', PostController::class)` registers 5 RESTful routes with a single line. It is equivalent to writing:
```php
Route::get('/posts',          [PostController::class, 'index']);
Route::post('/posts',         [PostController::class, 'store']);
Route::get('/posts/{post}',   [PostController::class, 'show']);
Route::put('/posts/{post}',   [PostController::class, 'update']);
Route::delete('/posts/{post}',[PostController::class, 'destroy']);
```
Run `php artisan route:list` to see all registered routes.

### Artisan CLI
Artisan is Laravel's built-in command-line tool. Common commands:
```bash
php artisan key:generate     # Generate APP_KEY
php artisan migrate          # Run pending DB migrations
php artisan route:list       # List all registered routes
php artisan make:model Foo   # Scaffold a new Eloquent model
php artisan make:controller  # Scaffold a new controller
php artisan tinker           # Open an interactive REPL with full app context
php artisan serve            # Start the built-in development server
```

### Service Providers
The `providers` array in `config/app.php` registers all Laravel subsystems (database, cache, queue, validation, etc.) during boot. Laravel 11 auto-discovers package providers, so you rarely need to edit this manually.

---

## 11. Screenshots

_Screenshots will be added after the API is deployed and tested._

**Suggested screenshots to capture:**
- `GET /api/health` — showing `"status": "ok"` with database confirmation
- `POST /api/posts` — creating a new post, showing the 201 response with the created object
- `GET /api/posts` — listing multiple posts with the count field
- `GET /api/posts?published=true` — demonstrating the filter query parameter
- `PUT /api/posts/{id}` — updating a post, showing changed fields in the response
- `DELETE /api/posts/{id}` — showing the success message
- `GET /api/posts/99999` — demonstrating the 404 JSON error
- `POST /api/posts` with missing fields — demonstrating the 422 validation error with field messages
